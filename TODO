- Correct code to work under newer GCC

Status:
-	todo
~	partially done
+	done
